<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://fabianbormann.github.io/meerkat/meerkat.min.js"></script>
    <script>
        const meerkat = new Meerkat({ 
            seed: 'BofdLENCoCxJroaUcjbj9gyhiozjR6o6ZnxgMD6TgtvpS6DbGsWi',
            announce: [
                'wss://tracker.files.fm:7073/announce',
                'wss://tracker.btorrent.xyz',
                'ws://tracker.files.fm:7072/announce',
                'wss://tracker.openwebtorrent.com:443/announce',
            ],
            loggingEnabled: true
         });

        const logger = meerkat.logger;
        logger.info(`The generated meerkat address is: ${meerkat.address()}`)

        var connected = false;
        meerkat.on("connections", function (clients) {
            if (clients == 0 && connected == false) {
                connected = true;
                logger.info("server ready");
            }
            logger.info(`${clients} clients connected`);
        });

        meerkat.register("api", function (address, args, callback) {
            const api = { version: args.api.version, address: address }

            for (method of args.api.methods) {
                api[method] = () => new Promise((resolve, reject) => {
                    meerkat.rpc(address, method, {}, (result) => resolve(result));
                });
            }

            window.cardano = window.cardano || {};
            window.cardano[args.api.name] = api;
            logger.info(`injected api of ${args.api.name} into window.cardano`);
        });
    </script>
    <title>DApp</title>
</head>
<body>
    <h1>Simple Example Dapp</h1>
    <p>Please open the console to see Meerkat in action.</p>
</body>
</html>